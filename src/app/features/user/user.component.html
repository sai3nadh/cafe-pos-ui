<!-- Container: Entire viewport -->
<div class="container">
    <!-- Top Navigation Bar -->
    <div class="top-bar" *ngIf="false">
      <div class="nav-buttons">
        <button (click)="goToHome()">Cafe-SISILI</button>
         <!-- Orders Button -->
         <button>
          <!-- (click)="showOrders = !showOrders; closeDropdown();openModal()" class="bg-blue-500 text-white px-4 py-2 rounded"> -->
          Orders</button>
      <!-- <button (click)="usersmenu()" class="bg-blue-500 text-white px-4 py-2 rounded"> -->
      <button (click)="toggleUsers()" class="bg-blue-500 text-white px-4 py-2 rounded">
          Users
        </button>
        <button (click)="showOrdersIcon = !showOrdersIcon; toggleOrdersModal();getCustomerOrdersToday();">Orders-Icon</button>
      </div>
    
        <!-- Avatar Section with Dropdown -->
      <div class="avatar-section">
        <button (click)="pendingOrders()"  class="lock-btn">Kitchen</button>
        <button (click)="logout()"  class="lock-btn">Lock</button>
        <img class="avatar" src="https://github.com/nutlope.png" alt="Avatar"  (click)="toggleDropdown()" />
          
          <!-- Dropdown Menu (Initially Hidden) -->
          <div *ngIf="dropdownVisible && canEdit" class="modal-overlay" (click)="closeCheckoutModal()">
          <div *ngIf="dropdownVisible" class="dropdown-menu">
              <!-- <button (click)="viewOrders()">View Orders</button>
              <button (click)="viewReports()">View Reports</button> -->
              <button >View Orders</button>
              <button (click)="viewReports()" >View Reports</button>
              <!-- Zoom Settings Button -->
              <button (click)="openZoomSettings()" class="bg-green-500 text-white px-4 py-2 rounded">Zoom Settings</button>
              <button (click)="addCustomer()">Add Customer</button>
              <button (click)="registerUser()">Register User</button>
              <button (click)="editItems()">Edit Items</button>
              <button (click)="pendingOrders()">Pending Orders</button>
      
                <hr />
            <button (click)="logout()">Logout</button>
          </div></div>
        </div>
  
    </div>

    <!-- Main Content Section -->
    <div class="main-content">
      <!-- Left Section (Categories and Items) -->
      <div class="left-section">
        <!-- Category Buttons -->
        <div class="categories">
          <button *ngFor="let category of categories" (click)="selectCategory(category)"
          [ngClass]="{'active-category': selectedCategory?.id === category.id}"
          
          >
            {{ category.name }}
          </button>
        </div>
  
        <!-- Items in Selected Category -->
        <div class="items-section" *ngIf="selectedCategory">
          <h2>{{ selectedCategory.name }}</h2>
          <div class="items-grid">
            <div 
      class="item-card" 
      *ngFor="let item of getItemsByCategory(selectedCategory.id)" 
      (click)="addToCart(item)">
            <!-- <div class="item-card" *ngFor="let item of getItemsByCategory(selectedCategory.id)"> -->
              <h3>{{ item.name }} </h3>
              <!-- <p>â‚¹{{ item.price.toFixed(2) }}</p> -->
              <!-- <img class="item-icons" src="../../../assets/icons/tea1.png" alt="Avatar" (click)="toggleDropdown()" /> -->
              <!-- <img class="item-icons" [src]="'../../../assets/icons/' + item.id + '.png'" alt="item.name" (click)="toggleDropdown()" /> -->
              <!-- <img class="item-icons" 
              [src]="imageBaseUrl + item.id + '.png'" loading="lazy"
              alt="item.name"  /> -->
              <img class="item-icons" 
              [src]="imageBaseUrl + item.imagePath " loading="lazy"
              alt="item.name"  />

              <!-- <img class="item-icons" src="../../../assets/icons/i.png https://github.com/nutlope.png" alt="Avatar" (click)="toggleDropdown()" /> -->

              <div class="button-container">
                <button (click)="remove(item); $event.stopPropagation()"
                style="background-color: rgb(202, 46, 34); color: white;">---</button>
                <button (click)="addToCart(item); $event.stopPropagation()" 
                style="background-color: rgb(14, 97, 14); color: white;">+++</button>
              </div>
              <div class="button-container" *ngIf="selectedCategory.id==5">
                <button (click)="addBoxToCart(item); $event.stopPropagation()" 
                style="background-color: rgb(14, 97, 14); color: white;">BOX</button>
              </div>
              <!-- <div class="button-container">
                <button (click)="remove(item)" >---</button>
                <button (click)="addToCart(item)">+++</button>
              </div>
               -->
                <!-- <button>Add</button>
                <button>Add</button> -->
              <!-- <button (click)="addToCart(item)">Add</button> -->
            </div>
          </div>
        </div>
      </div>
      <div class="right-section" [ngClass]="{ 'user-selected': selectedUser !== null }">

        <input type="text" [(ngModel)]="guestName" placeholder="Guest Name" [disabled]="guestName.startsWith('edit Order - #')"/>
  
                 
              <div class="cart-items" [ngClass]="{ 'with-bg': selectedUser !== null }">

                <!-- PART 1: New Items (TOP) -->
                <div>
                    <h3>New Items</h3>
                    <ul>
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
                    
                    <li *ngFor="let item of cart; let i = index">
                          <!-- enable below to work on customize items -->
                      <div class="cart-item" 

                        (click)="item.kitchen ? cusotmizeCartItem(item) : null">

                         <!-- (click)="cusotmizeCartItem(item)"> -->
                        <!-- Item Name and Delete Button on the same row -->
                        <div class="cart-item-header">
                            <h3>{{ item.name }}</h3>
                            <i *ngIf="item.itemStatus !== 'delivered'"  class="fas fa-trash-alt" (click)="confirmDeleteItem(i)"></i>
                        </div>
                
                        <!-- Cart Item Details (Quantity, Price) in the next row -->
                        <div class="cart-item-details">
                            <label>Qty:</label>
                            <input 
                            type="number" 
                            [(ngModel)]="item.qty" 
                            (change)="updateCartItem(item)" 
                            size="4" 
                            />
                            <span>
                            x â‚¹{{ item.price.toFixed(2) }} 
                            = 
                            â‚¹{{ (item.price ) * (item.qty) | number:'1.2-2' }}
                            </span>

                        </div>
                        </div>
                        <hr />
                    </li>
                    </ul>
                </div>
            
                <hr />
              
                
               <!-- Show total pending amount above the orders -->
              <p *ngIf="getTotalPendingAmount() > 0">
                <strong>Total Pending Amount: â‚¹{{ getTotalPendingAmount() | number:'1.2-2' }}</strong>
              </p>

                <div *ngIf="purchaseHistory && purchaseHistory.length > 0">
                  <h4>Previous Orders for this Customer</h4>
                
                  <!-- Iterate through each order -->
                  <div *ngFor="let order of purchaseHistory">
                    <p><strong>Order ID:</strong> {{ order.id }}</p>
                    <p><strong>Order Number:</strong> {{ order.orderNumber }}</p>
                    <p><strong>Time:</strong> {{ order.time }}</p>
                    <p><strong>Status:</strong> {{ order.status }}</p>
                    <p><strong>Pending Amount:</strong> â‚¹{{ (order.total - order.paidAmount) | number:'1.2-2' }}</p>
                
                    <h5>Items:</h5>
                    <ul>
                      <li *ngFor="let item of order.items">
                        {{ item.name }} (x{{ item.qty  }}) - â‚¹{{ (item.price * (item.qty )) | number:'1.2-2' }}
                      </li>
                    </ul>
                    <hr />
                  </div>
                </div>
                
                
              </div>

              
              
        <div class="total">
          Total: â‚¹{{ getTotal().toFixed(2) }}
        </div>
    
        <div class="totals">
          <!-- Total amount including current cart and pending amount -->
          <p>
            <strong>
              Grand Total: â‚¹{{ (getTotal() + getTotalPendingAmount()) | number:'1.2-2' }}
            </strong>
          </p>
        
          <!-- Show pending amount separately if it's greater than 0 -->
          <p *ngIf="getTotalPendingAmount() > 0">
            <strong>Total Pending Amount: â‚¹{{ getTotalPendingAmount() | number:'1.2-2' }}</strong>
          </p>
        </div>
        
        <!-- <button (click)="checkout()">Checkout</button> -->
        <button (click)="checkout()" [disabled]="cart.length === 0 && purchaseHistory.length === 0 ">Checkout</button>
    </div>
    

    </div>
  </div>

  <div *ngIf="zoomModalVisible" class="modal-overlay" (click)="closeZoomSettings()">
    
      <!-- Zoom Modal (Initially Hidden) -->
  <!-- <div *ngIf="zoomModalVisible" class="zoom-modal-overlay" (click)="$event.stopPropagation()"> -->
    <div class="zoom-modal" (click)="$event.stopPropagation()">
      <h3>Set Zoom Level</h3>
      <label for="zoomSlider">Zoom Level: </label>
      
      <!-- Left and Right Buttons -->
      <div class="zoom-buttons">
        <button (click)="changeZoom(-0.05)">-</button>
        <input
          id="zoomSlider"
          type="range"
          min="0.5"
          max="2"
          step="0.05"
          [(ngModel)]="zoomLevel"
          (input)="adjustZoom($event)"
        />
        <button (click)="changeZoom(0.05)">+</button>
      </div>
      
      <span>{{ (zoomLevel * 100).toFixed(0) }}%</span>
      
      <button (click)="closeZoomSettings()">Close</button>
    </div>
  <!-- </div> -->
</div>
  <!-- Confirmation Modal -->
<!-- Confirmation Modal -->

  <!-- Confirmation Modal -->
<div *ngIf="showDeleteModal" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal" (click)="$event.stopPropagation()"> <!-- Prevent modal from closing when clicking inside -->
      <h3>Are you sure you want to remove this item?</h3>
      <div class="modal-buttons">
        <button (click)="deleteItem()">Confirm</button>
        <button (click)="cancelDelete()">Cancel</button>
      </div>
    </div>
  </div>
  
  <div *ngIf="customizeCartItemModal" class="modal-overlay" (click)="cancelCartItemNote()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Customize {{ selectedItem?.name }}</h3>
            
            <!-- Only show the customization form if selectedItem is not null -->
      <!-- <div *ngIf="selectedItem">
        Customize Item Note
        <label for="item-note">Note:</label>
        <textarea id="item-note" [(ngModel)]="selectedItem.itemNote"></textarea>

        Customize Item Quantity
        <label for="item-qty">Quantity:</label>
        <input type="number" [(ngModel)]="selectedItem.qty" min="1">
      </div> -->

      <!-- Modifier Customization -->
<div *ngIf="selectedItem?.modifiers?.length">
  <h4>Modifiers (split quantity):</h4>
  <div *ngFor="let mod of selectedItem?.modifiers" class="modifier-row">
    <input type="number" [(ngModel)]="mod.qty" min="0" [max]="selectedItem?.qty || null">
    <span>{{ mod.name }}</span>
  </div>
  <p>Total modifier quantity: {{ getModifierTotalQty() }} / {{ selectedItem?.qty }}</p>
</div>

      <div class="modal-actions">
        <button (click)="saveCustomization()">Save</button>
        <button (click)="closeCustomizeModal()">Cancel</button>
      </div>
    </div>
  
  </div>

  <div *ngIf="showCheckoutModal" class="modal-overlay" (click)="closeCheckoutModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>Confirm Payment</h3>
      <p>Amount: â‚¹{{ getTotal().toFixed(2) }}</p>
     
      Custom Amount: <input
      type="number"
      [(ngModel)]="customAmount"
      placeholder="Enter custom amount"
      class="input-field"
      min="0"
    />

    <!-- Sitting Area Toggle -->
<div class="sitting-area-toggle">
  <button 
    [class.active]="selectedSittingArea === 'front'" 
    (click)="toggleSittingArea('front')" 
    style="color: black; font-weight: bold;">
    Front Side
  </button>
  <button 
    [class.active]="selectedSittingArea === 'back'" 
    (click)="toggleSittingArea('back')" 
    style="color: black; font-weight: bold;">
    Back Side
  </button>
</div>
      <!-- Toggle Buttons for Payment Type -->
      <!-- <div class="payment-toggle">
        <button 
          [class.active]="selectedPaymentType === 'cash'" 
          (click)="selectPaymentType('cash')" 
          style="color: black; font-weight: bold;">
          Cash
        </button>
        <button 
          [class.active]="selectedPaymentType === 'upi'" 
          style="color: black; font-weight: bold;"
          (click)="selectPaymentType('upi')">
          UPI
        </button>
      </div> -->

      <!-- Toggle Button Group -->
      <div class="payment-toggle">
        <label [class.active]="selectedPaymentMethodId === 1">
          <input type="radio" name="paymentMethod" [value]="1" [(ngModel)]="selectedPaymentMethodId" />
          Cash
        </label>

        <label [class.active]="selectedPaymentMethodId === 2">
          <input type="radio" name="paymentMethod" [value]="2" [(ngModel)]="selectedPaymentMethodId" />
          UPI
        </label>
      </div>
  
      <div class="modal-buttons">
        <button (click)="handlePayment('full')">Full Pay</button>
        <button (click)="confirmPartialPay()">Partial Pay</button>
        <button (click)="closeCheckoutModal()">Cancel</button>
      </div>
  
      <!-- Partial Pay Input -->
      <div *ngIf="partialPayMode" class="partial-pay">
        <label>
          Enter Partial Amount:
          <input type="number" 
          style="width: 40%;"
          min="0"
          [(ngModel)]="partialPayAmount" (input)="validatePartialPayAmount()" />
        </label><br>
        <button [disabled]="!isPartialAmountValid" (click)="submitPartialPay()"
        style="font-weight: bold; font-size: xxx-large;">Submit</button>
      </div>
    </div>
  </div>
  

   <!-- <div *ngIf="showOrders" class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-title">Orders</h3>
      <table class="orders-table">
        <thead>
          <tr>
            <th class="table-cell">Order ID</th>
            <th class="table-cell">Time</th>
            <th class="table-cell">Status</th>
            <th class="table-cell actions-cell">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of orders" class="order-row">
            <td class="table-cell">{{ order.id }}</td>
            <td class="table-cell">{{ order.time }}</td>
            <td class="table-cell">{{ order.status }}</td>
            <td class="table-cell actions-cell">
              <button (click)="editOrder(order)" class="edit-btn">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>
      <button (click)="showOrders = false" class="close-btn">Close</button>
    </div>
  </div> -->
  <div *ngIf="showOrders" class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-title">Orders</h3>
      
      <!-- Filter buttons -->
      <div class="filter-buttons">
        <button (click)="filterOrders('Pending')" class="filter-btn" [class.active]="selectedStatus === 'Pending'">Pending</button>
        <button (click)="filterOrders('Completed')" class="filter-btn" [class.active]="selectedStatus === 'Completed'">Completed</button>
        <button (click)="filterOrders('Draft')" class="filter-btn" [class.active]="selectedStatus === 'Draft'">Draft</button>
      </div>
  
      <!-- Orders Table -->
      <table class="orders-table">
        <thead>
          <tr>
            <th class="table-cell">Order ID</th>
            <th class="table-cell">Time</th>
            <th class="table-cell">Status</th>
            <th class="table-cell actions-cell">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of filteredOrders" class="order-row">
            <td class="table-cell">{{ order.id }}</td>
            <td class="table-cell">{{ order.time }}</td>
            <td class="table-cell">{{ order.status }}</td>
            <td class="table-cell actions-cell">
              <button (click)="editOrder(order)" class="edit-btn">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>
      
      <!-- Close button -->
      <button (click)="showOrders = false" class="close-btn">Close</button>
    </div>
  </div>
  
<!-- Orders Modal -->

<!-- Orders Modal -->
<div *ngIf="showOrdersIcon" class="custom-modal-overlay" (click)="toggleOrdersModalClose()">
 
  <!-- <div *ngIf="showOrdersIcon" class="custom-modal-overlay"> -->
    <div class="modal-content-icon" (click)="$event.stopPropagation()">
      <!-- Close Button -->
      <button (click)="toggleOrdersModalClose()" class="close-btn">X</button>
    
      <h2 class="text-lg font-bold mb-4">Orders</h2>
      <div class="flex justify-center mb-4 space-x-4">
        <button class="btn-filter" [class.active]="selectedStatus === 'All'" (click)="handleFilterChange('All')">All</button>
        <button class="btn-filter" [class.active]="selectedStatus === 'Pending'" (click)="handleFilterChange('Pending')">Kitchen</button>
        <button class="btn-filter" [class.active]="selectedStatus === 'Ready'" (click)="handleFilterChange('Ready')">Ready</button>
        <button class="btn-filter" [class.active]="selectedStatus === 'Completed'" (click)="handleFilterChange('Completed')">Completed</button>
        <button class="btn-filter" [class.active]="selectedStatus === 'unpaid'" (click)="handleFilterChange('unpaid')">Unpaid</button>
        <button class="btn-filter" 
                [class.active]="selectedStatus === 'CustomerOrders'" 
                (click)="handleFilterChange('CustomerOrders')"> Customer Orders</button>
      </div>
    
      <div class="order-bottom-section">
        <div class="bottom-left">
          <div class="order-grid-responsive">
            <div *ngFor="let order of filteredOrders" class="order-item-responsive" (click)="showOrderDetails(order)" [ngClass]="{'selected-order': selectedOrder?.orderNumber === order.orderNumber}">
              <!-- <div class="order-circle" [ngClass]="{'text-red-500': order.status === 'Pending', 'text-green-500': order.status === 'Completed'}">
                <div class="order-text">
                  <span>{{ order.orderNumber | slice: -3 }}</span>
                  <span class="order-status">{{ order.status }}</span>
                </div>
              </div> -->

              <div class="order-circle" 
     [ngClass]="getOrderCircleClass(order)">
  <div class="order-text">
    <span>{{ order.orderNumber | slice: -3 }}</span>
    <span class="order-status">{{ order.status }}</span>
  </div>
</div>

            </div>
          </div>
        </div>
        <div class="bottom-right">
          <div class="order-details-fixed" *ngIf="selectedOrder">
            <h3 style="margin-bottom: 10px; font-size: 1.5em;">Order Items - #{{ selectedOrder.orderNumber | slice: -3}}</h3>
            <h5 style="margin-top: 10px; margin-bottom: 5px; text-align: justify;">Time: {{selectedOrder.time}}</h5>
            <!-- <ul>
              <li *ngFor="let item of selectedOrder.items">
                {{ item.name }} - {{ item.qty }}
              </li>
            </ul> -->
            <h4 *ngIf="selectedOrderCustomerName" style="margin-bottom: 5px; text-align: justify;
                COLOR: blue;
    margin-bottom: 5px;
    text-align: justify;
    MARGIN-TOP: 10PX;
">
              ðŸ‘¤ Customer: <strong>{{ selectedOrderCustomerName }}</strong>
            </h4>
            <div *ngFor="let item of selectedOrder.items" class="item-row">
              <span class="item-name">{{ item.name }}</span>
              <span class="item-qty"> - {{ item.qty }}-- {{ item.itemStatus }}</span><br>
            </div>
            <!-- <h5 *ngIf="selectedOrderCustomerName" style="margin-bottom: 5px; text-align: justify;">
              ðŸ‘¤ Customer: <strong>{{ selectedOrderCustomerName }}</strong>
            </h5> -->
            
            <div class="order-summary" style="text-align: right; font-weight: bold;">
              <hr/>
            <p><strong>Total:</strong> {{ selectedOrder.total | currency: 'INR' }}</p>
            <p><strong>Pending Amount:</strong> {{ selectedOrder.total - selectedOrder.paidAmount | currency: 'INR' }}</p>
            </div>
            <div class="button-section">
              <div style="
              display: flex;
              justify-content: space-evenly;
              margin: -50px;
              margin-top: 0px;">
              <button class="btn-edit" (click)="editOrder(selectedOrder);toggleOrdersModalClose();">Edit</button>
              <button class="btn-finish" 
              (click)="finishOrder(selectedOrder)" 
              [disabled]="selectedOrder.status !== 'Pending' && selectedOrder.status !== 'Ready'"
              
              >Finish</button>
              </div>
              <!-- [disabled]="selectedOrder.status !== 'Pending'" -->
              <br/><br/>
              <!-- *ngIf="selectedOrder.total - selectedOrder.paidAmount !== 0"               -->
              <button class="btn-pay" 
 
              [disabled]="selectedOrder.total - selectedOrder.paidAmount === 0"
              (click)="openPaymentMethodPop(selectedOrder)">Pay</button>
              
              <!-- (click)="updatePendingPayment(selectedOrder)">pay</button> -->

              <button class="btn-reprint" (click)="reprintOrder(selectedOrder)">Reprint</button>
              <!--               -->
              <br><br>
              <button class="btn-complete" *ngIf="selectedOrder.total - selectedOrder.paidAmount !== 0 &&
                selectedOrder.status !== 'Completed'" 
 
              [disabled]="selectedOrder.total - selectedOrder.paidAmount === 0"
              (click)="openPaymentPopupForFinish(selectedOrder); ">Finish-pay</button>

              <button class="btn-ready" *ngIf="selectedOrder.status === 'Pending'" 
               (click)="readyOrder(selectedOrder)">Ready</button>
            </div>
          </div>
        </div>
      </div>
    </div>
   
    <!-- Pay and close the order -->
    <!-- Finish & Pay - Payment Method Popup -->
    <div *ngIf="isPaymentPopupOpen && selectedPaymentOrder" class="popup-overlay"  (click)="isPaymentPopupOpen = !isPaymentPopupOpen;$event.stopPropagation();">


      <div class="popup" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <span>Select Payment Method</span>
          <button (click)="isPaymentPopupOpen = false; isFinishFlow = false;" class="close-btn">X</button>
        </div>
        <div class="popup-content">

          <div class="popup-row">
            <span>Order Number</span>
            <span>#{{ selectedPaymentOrder.orderNumber | slice: -3 }}</span>
          </div>

          <div class="popup-row">
            <span>Total Amount</span>
            <span>{{ selectedPaymentOrder.total | currency: 'INR' }}</span>
          </div> 
          <div class="popup-row">
            <span>Paid Amount</span>
            <span>{{selectedPaymentOrder.paidAmount | currency: 'INR' }}</span>
          </div> 
          <div class="popup-row">
            <span>Pending Amount</span>
            <span>{{ selectedPaymentOrder.total - selectedPaymentOrder.paidAmount | currency: 'INR' }}</span>
          </div>

          <div class="payment-toggle">
            <label [class.active]="selectedPaymentMethodId === 1">
              <input type="radio" name="paymentMethod" [value]="1" [(ngModel)]="selectedPaymentMethodId" />
              ðŸ’° Cash
            </label>
            <label [class.active]="selectedPaymentMethodId === 2">
              <input type="radio" name="paymentMethod" [value]="2" [(ngModel)]="selectedPaymentMethodId" />
              ðŸ“² UPI
            </label>
          </div>
        </div>

        <div class="popup-footer">
          <button class="btn" (click)="updatePendingPayment(selectedPaymentOrder)">Pay</button>
          <button class="btn" (click)="isPaymentPopupOpen = false; isFinishFlow = false;">Cancel</button>
        </div>
      </div>
    </div>
  <!-- </div> -->
</div>

  <div class="users-btn-container">
    <!-- Button to toggle user list visibility -->
    <button class="btn" (click)="toggleUsers()">Users</button>
  <!-- Button to toggle user list visibility -->
  <button class="btn" (click)="emptyCart()" 
          [disabled]="!(cart.length > 0 || purchaseHistory.length > 0 || selectedUser)"
          >clearCart</button>

  <img *ngIf="selectedUser?.avatar" class="selected-user" [src]="selectedUser?.avatar" alt={{selectedUser?.name}} hidden/>
    
  <div *ngIf="showUsers" class="modal-overlay" (click)="closeUsersModal()">
  <!-- User list with search functionality -->
    <div class="users-list" *ngIf="showUsers"  (click)="$event.stopPropagation()">
      <div class="search-bar">
        <input [(ngModel)]="searchTerm" placeholder="Search users" />
            <span class="close-icon" (click)="toggleUsers()">
            <i class="fa-solid fa-xmark"></i>
          </span>
      </div>
      <div class="users">
        
      <!-- <div class="user" 
            *ngFor="let user of filteredUsers()" 
            (click)="selectUser(user)"> 
            <img [src]="user.avatar" alt="Avatar" class="user-avatar" />
            <p>{{ user.name }}</p>
        </div> -->
        <div class="user" *ngFor="let customer of filteredCustomers()"
        (click)="selectUser(customer)">
          <img [src]="customer.avatar" alt="{{ customer.name }}" class="user-avatar">
          <p>{{ customer.name }}</p>
        </div>
      </div>
    </div>
    </div>
  </div>


  <div *ngIf="customerCheckoutPopup" class="order-container" (click)="handleOverlayClick($event)" >
    <!-- Cart Amount -->
    <div class="cart-card" (click)="$event.stopPropagation()">
      <div class="card-header">Checkout</div>
      <div class="card-content">
        <div class="cart-amount">Cart Amount â‚¹{{ cartAmount }}</div>
        <!-- <div class="cart-amount">Cart Amount ${{ getTotal().toFixed(2)}}</div> -->
        Custom Amount: <input
          type="number"
          [(ngModel)]="customAmount"
          placeholder="Enter custom amount"
          class="input-field"
          min="0"
        />
      </div>
      <div class="sitting-area-toggle" *ngIf="+cartAmount > 0">
        <button 
          [class.active]="selectedSittingArea === 'front'" 
          (click)="toggleSittingArea('front')" 
          style="color: black; font-weight: bold;">
          Front Side
        </button>
        <button 
          [class.active]="selectedSittingArea === 'back'" 
          (click)="toggleSittingArea('back')" 
          style="color: black; font-weight: bold;">
          Back Side
        </button>
        <hr/>
      </div>
      <div class="payment-toggle" style="margin: 15px;">
        <label [class.active]="selectedPaymentMethodId === 1">
          <input type="radio" name="paymentMethod" [value]="1" [(ngModel)]="selectedPaymentMethodId" />
          Cash
        </label>

        <label [class.active]="selectedPaymentMethodId === 2">
          <input type="radio" name="paymentMethod" [value]="2" [(ngModel)]="selectedPaymentMethodId" />
          UPI
        </label>
      </div>
  
       <!-- Toggle Buttons for Payment Type -->
       <!-- <div class="payment-toggle">
        <button 
          [class.active]="selectedPaymentType === 'cash'" 
          (click)="selectPaymentType('cash')" 
          style="color: black; font-weight: bold;">
          Cash
        </button>
        <button 
          [class.active]="selectedPaymentType === 'upi'" 
          style="color: black; font-weight: bold;"
          (click)="selectPaymentType('upi')">
          UPI
        </button>
      </div> -->
  
      <!--  <div class="modal-buttons"> -->
        <!-- <button (click)="confirmFullPay()">sssssFull Pay</button> -->
        <!-- <button (click)="confirmPartialPay()">Partial Pay</button> -->
        <!-- <button (click)="closeCheckoutModal()">Cancel</button> -->
      <!-- </div> -->
  
      <!-- Partial Pay Input -->
      <!-- <div *ngIf="partialPayMode" class="partial-pay">
        <label>
          Enter Partial Amount:
          <input type="number" [(ngModel)]="partialPayAmount" (input)="validatePartialPayAmount()" />
        </label>
        <button [disabled]="!isPartialAmountValid" (click)="submitPartialPay()"
        style="font-weight: bold; font-size: x-large;">Submit</button>
      </div> -->
      <div class="card-footer" *ngIf="+cartAmount > 0" >
        <!-- <button (click)="handlePaymentOption('full')" class="btn">Full Pay</button>
        <button (click)="confirmPartialPay()" class="btn">Partial Pay</button>
        <button (click)="handleClosePopup()" class="btn">Save</button>
        <button (click)="closeCheckoutModal()" class="btn">Cancel</button> -->

        <button (click)="handlePayment('full')" class="btn">Full Pay</button>
        <button (click)="confirmPartialPay()" class="btn">Partial Pay</button>
        <button (click)="handlePayment('save')" class="btn">Save</button>
        <button (click)="closeCheckoutModal()" class="btn">Cancel</button>

        <!-- <button (click)="handlePay()" class="btn">Pay Custom Amount</button> -->
      </div>

      <div *ngIf="partialPayMode" class="partial-pay">
        <label>
          Enter Partial Amount:
          <input type="number" min="0" [(ngModel)]="partialPayAmount" (input)="validatePartialPayAmount()" />
        </label>
        <button [disabled]="!isPartialAmountValid" (click)="submitPartialPay()"
        style="font-weight: bold; font-size: x-large;">Submit</button>
      </div>
        


    </div>
  
    <div class="modal" (click)="$event.stopPropagation()" hidden>
      <h3>Confirm Payment</h3>
      <p>Amount: â‚¹{{ getTotal().toFixed(2) }}</p>
  
      <!-- Toggle Buttons for Payment Type -->
      <div class="payment-toggle">
        <button 
          [class.active]="selectedPaymentType === 'cash'" 
          (click)="selectPaymentType('cash')" 
          style="color: black; font-weight: bold;">
          Cash
        </button>
        <button 
          [class.active]="selectedPaymentType === 'upi'" 
          style="color: black; font-weight: bold;"
          (click)="selectPaymentType('upi')">
          UPI
        </button>
      </div>
  
      <div class="modal-buttons">
        <button (click)="confirmFullPay()">Full Pay</button>
        <button (click)="confirmPartialPay()">Partial Pay</button>
        <button (click)="closeCheckoutModal()">Cancel</button>
      </div>
  
      <!-- Partial Pay Input -->
      <div *ngIf="partialPayMode" class="partial-pay">
        <label>
          Enter Partial Amount:
          <input type="number" [(ngModel)]="partialPayAmount" (input)="validatePartialPayAmount()" />
        </label>
        <button [disabled]="!isPartialAmountValid" (click)="submitPartialPay()"
        style="font-weight: bold; font-size: x-large;">Submit</button>
      </div>
    </div>

    <!-- Totals -->
    <div class="totals-card" (click)="$event.stopPropagation()">
      <div class="card-header">Totals</div>
      <div class="card-content">
        <div class="totals-row" style="font-size: 1.4em; padding-bottom: 20px;">
          <span>Final Amount &nbsp;</span>
            â‚¹{{ (getTotal() + getTotalPendingAmount()) | number:'1.2-2' }}

        </div>
        <div class="totals-row" style="color: rgb(228, 1, 1);">
          <span>Cart &nbsp;</span>
          <span>{{ cartAmount | currency: 'INR'}}</span>
          <span> &nbsp;&nbsp;&nbsp;  Pending Amount &nbsp;</span>
          <span>{{ totalUnpaidOrders | currency: 'INR'}}</span>
        </div>
        <!-- <div class="totals-row">
          <span>Total Unpaid Orders</span>
          <span>${{ totalUnpaidOrders }}</span>
        </div> -->
      </div>
    </div>
  
    <!-- Unpaid Orders List -->
    <!-- <div class="orders-card">
      <div class="card-header">Unpaid Orders</div>
      <div class="orders-list">
        <div *ngFor="let order of unpaidOrders" class="order-item">
          <div>
            <div class="order-id">{{ order.orderId }}</div>
            <div class="order-date">{{ order.date }} Â· {{ order.time }}</div>
          </div>
          <div class="order-amount">${{ order.pendingAmount.toFixed(2) }}</div>
          <button (click)="handleOpenPopup(order.id)" class="btn">Confirm</button>
        </div>
      </div>
    </div>
   -->
   
   <!-- Unpaid Orders List -->
<div class="orders-card" *ngIf="selectedUser" (click)="$event.stopPropagation()" >
  <div class="card-header">Unpaid Orders for User: {{ selectedUser.name }}</div>
    <!-- Send All Pending Orders Button -->

    <div class="send-all-btn-div">
    <button class="send-all-btn" [disabled]="!canEdit" (click)="openPaymentMethodPopup()">
      Settle All Pending Amounts
    </button>
  </div>
  <div class="note" *ngIf="!canEdit">
    <h2 style="color: red;">ðŸ”’ Only an admin or owner can settle dues. Please reach out to them.</h2>
  </div>

  <div class="orders-list">
    <!-- Iterate through the orders for the selected user -->
    <div *ngFor="let order of getUserOrders(selectedUser.id)" class="order-item">
      <div>
        <div class="order-id">{{ order.orderNumber }}</div>
        <div class="order-date">{{ order.time }} </div>
      </div>
      <div class="order-amount">
        {{ (order.total - order.paidAmount) | currency: 'INR' }}

        <!-- ${{ +order.total.toFixed(2) | currency: 'INR' - order.paidAmount  | currency: 'INR'}} -->
      </div>
      
      <!-- Confirm Button -->
      <button (click)="handleOpenPopup(order.id)"  [disabled]="!canEdit" >Confirm</button>
    </div>
  </div>
</div>

<!-- Payment Method Selection Popup -->
<div *ngIf="isPaymentMethodPopupOpen" class="popup-overlay" hidden>
  <div class="popup">
    <div class="popup-header">
      <span>Select Payment Method</span>
      <button (click)="closePaymentMethodPopup()" class="close-btn">X</button>
    </div>

    <div class="popup-content">
      <p>How do you want to settle all pending amounts?</p>

      <div class="payment-options">
        <button class="btn" (click)="confirmSettleAll(1)">ðŸ’° Cash</button>
        <button class="btn" (click)="confirmSettleAll(2)">ðŸ“² UPI</button>
      </div>
    </div>
  </div>
</div>
<!-- Payment Method Selection Popup -->
<div *ngIf="isPaymentMethodPopupOpen" class="popup-overlay popup-settle">
  <div class="popup" >
    <div class="popup-header">
      <span>Select Payment Method</span>
      <button (click)="closePaymentMethodPopup()" class="close-btn">X</button>
    </div>

    <div class="popup-content">
      <p>How do you want to settle all pending amounts?</p>

      <!-- Toggle Button Group -->
      <div class="payment-toggle">
        <label [class.active]="selectedPaymentMethodId === 1">
          <input type="radio" name="paymentMethod" [value]="1" [(ngModel)]="selectedPaymentMethodId" />
          ðŸ’° Cash
        </label>

        <label [class.active]="selectedPaymentMethodId === 2">
          <input type="radio" name="paymentMethod" [value]="2" [(ngModel)]="selectedPaymentMethodId" />
          ðŸ“² UPI
        </label>
      </div>
    </div>

    <div class="popup-footer">
      <button class="btn" [disabled]="!selectedPaymentMethodId" (click)="finishSettleAll()">Finish</button>
      <button class="btn" (click)="closePaymentMethodPopup()">Cancel</button>
    </div>
  </div>
</div>



   
   <!-- Confirmation Popup -->
<div *ngIf="isPopupOpen && selectedOrderDetails && canEdit" class="popup-overlay">
  <div class="popup">
    <div class="popup-header">
      <span>Confirm Payment</span>
      <button (click)="handleClosePopup()" class="close-btn">X</button>
    </div>
    <div class="popup-content">
      <!-- Order ID Row -->
      <div class="popup-row">
        <span>Order ID</span>
        <span>{{ selectedOrderDetails.orderNumber }}</span>
      </div>
      <!-- Date Row -->
      <div class="popup-row">
        <span>Date</span>
        <span>{{ selectedOrderDetails.time }}</span>
      </div>
      <!-- Time Row -->
      <div class="popup-row">
        <span>Time</span>
        <span>{{ selectedOrderDetails.time }}</span>
      </div>
       <!-- Paid Amount Row -->
       <div class="popup-row">
         <span>Already paid Amount</span>
         <span>{{ selectedOrderDetails.total| currency: 'INR'}}</span>
       </div>
        <!-- Paid Amount Row -->
        <div class="popup-row">
          <span>Already paid Amount</span>
          <span>{{ selectedOrderDetails.paidAmount | currency: 'INR'}}</span>
        </div>
      <!-- Pending Amount Row -->
      <div class="popup-row amount">
        <span>Pending Amount</span>
        <span>{{ (selectedOrderDetails.total - selectedOrderDetails.paidAmount) | currency: 'INR' }}</span>

        <!-- <span>${{ (selectedOrderDetails.total.toFixed(2)-selectedOrderDetails.total.toFixed(2)) | currency: 'INR'}}</span> -->
      </div>
      
      <!-- Payment Method Toggle -->
      <div class="payment-toggle">
        <label [class.active]="selectedPaymentMethodId === 1">
          <input type="radio" name="paymentMethod" [value]="1" [(ngModel)]="selectedPaymentMethodId" />
          ðŸ’° Cash
        </label>
        <label [class.active]="selectedPaymentMethodId === 2">
          <input type="radio" name="paymentMethod" [value]="2" [(ngModel)]="selectedPaymentMethodId" />
          ðŸ“² UPI
        </label>
      </div>
    </div>
    <div class="popup-footer">
      <button (click)="handlePaymentOption('full')" class="btn">Pay</button>
      <!-- <button (click)="handlePaymentOption('partial')" class="btn">Partial Pay</button> -->
      <button (click)="handleClosePopup()" class="btn">Cancel</button>
      <!-- <button (click)="handlePay()" [disabled]="!paymentOption" class="btn">Pay</button> -->
    </div>
  </div>
</div>

   <!-- Confirmation Popup -->
    <!-- <div *ngIf="isPopupOpen && selectedOrderDetails" class="popup-overlay">
      <div class="popup">
        <div class="popup-header">
          <span>Confirm Payment</span>
          <button (click)="handleClosePopup()" class="close-btn">X</button>
        </div>
        <div class="popup-content">
          <div class="popup-row">
            <span>Order ID</span>
            <span>{{ selectedOrderDetails.orderId }}</span>
          </div>
          <div class="popup-row">
            <span>Date</span>
            <span>{{ selectedOrderDetails.date }}</span>
          </div>
          <div class="popup-row">
            <span>Time</span>
            <span>{{ selectedOrderDetails.time }}</span>
          </div>
          <div class="popup-row amount">
            <span>Pending Amount</span>
            <span>${{ selectedOrderDetails.pendingAmount.toFixed(2) }}</span>
          </div>
        </div>
        <div class="popup-footer">
          <button (click)="handlePaymentOption('full')" class="btn">Full Pay</button>
          <button (click)="handlePaymentOption('partial')" class="btn">Partial Pay</button>
          <button (click)="handleClosePopup()" class="btn">Cancel</button>
          <button (click)="handlePay()" [disabled]="!paymentOption" class="btn">Pay</button>
        </div>
      </div>
    </div> -->
  </div>
  
  <!-- In your component's HTML -->
<div *ngIf="isLoading" class="spinner-overlay">
  <div class="spinner"></div>
</div>
<!-- ngx-spinner -->
<!-- <ngx-spinner *ngIf="isLoading" [bdColor]="'rgba(0, 0, 0, 0.7)'" [size]="'medium'" [color]="'#fff'" [fullScreen]="true"></ngx-spinner> -->
